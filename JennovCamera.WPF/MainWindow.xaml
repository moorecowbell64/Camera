<Window x:Class="JennovCamera.WPF.MainWindow"
        KeyDown="Window_KeyDown"
        KeyUp="Window_KeyUp"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Jennov PTZ Camera Control"
        Height="900" Width="1400"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="*" MinWidth="320"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel - Video Display -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Video Display -->
            <Border Grid.Row="0"
                    BorderBrush="{StaticResource PrimaryBrush}"
                    BorderThickness="2"
                    Background="Black"
                    CornerRadius="5">
                <Grid>
                    <Image x:Name="VideoImage"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="LowQuality"
                           MouseDown="VideoImage_MouseDown"
                           MouseUp="VideoImage_MouseUp"
                           MouseLeave="VideoImage_MouseLeave"
                           Cursor="Cross"/>
                    <TextBlock x:Name="NoVideoText"
                               Text="No Video Feed&#x0a;&#x0a;Click 'Connect' to start"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="White"
                               FontSize="18"
                               TextAlignment="Center"/>

                    <!-- Calibration Overlay -->
                    <Grid x:Name="CalibrationOverlay" Visibility="Collapsed">
                        <Rectangle Fill="#80000000"/>
                        <Canvas x:Name="CalibrationCanvas"
                                MouseDown="CalibrationCanvas_MouseDown"
                                Background="Transparent"/>
                        <StackPanel VerticalAlignment="Top" HorizontalAlignment="Left" Margin="10,30,0,0">
                            <TextBlock x:Name="CalibrationInstructions"
                                       Text="CALIBRATION MODE"
                                       Foreground="White"
                                       FontSize="12"
                                       TextAlignment="Left"
                                       Padding="10"
                                       Background="#CC333333"/>
                        </StackPanel>
                        <TextBlock x:Name="CalibrationStepText"
                                   VerticalAlignment="Bottom"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,20"
                                   Foreground="Yellow"
                                   FontSize="14"
                                   FontWeight="Bold"
                                   TextAlignment="Center"
                                   Padding="10"
                                   Background="#CC333333"/>
                    </Grid>

                    <!-- Connection Progress Overlay -->
                    <Grid x:Name="ConnectionOverlay" Visibility="Collapsed">
                        <Rectangle Fill="#E0000000"/>
                        <Border Background="#FF1E1E1E"
                                BorderBrush="{StaticResource PrimaryBrush}"
                                BorderThickness="2"
                                CornerRadius="15"
                                Padding="40,30"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                MinWidth="400">
                            <Border.Effect>
                                <DropShadowEffect Color="#00D4AA" BlurRadius="30" ShadowDepth="0" Opacity="0.5"/>
                            </Border.Effect>
                            <StackPanel>
                                <!-- Header with animated spinner -->
                                <Grid Margin="0,0,0,25">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Spinning ring -->
                                    <Grid Width="50" Height="50" Margin="0,0,20,0">
                                        <Ellipse Stroke="#333333" StrokeThickness="4"/>
                                        <Ellipse x:Name="SpinnerRing"
                                                 Stroke="{StaticResource PrimaryBrush}"
                                                 StrokeThickness="4"
                                                 StrokeDashArray="2 4"
                                                 RenderTransformOrigin="0.5,0.5">
                                            <Ellipse.RenderTransform>
                                                <RotateTransform x:Name="SpinnerRotation" Angle="0"/>
                                            </Ellipse.RenderTransform>
                                        </Ellipse>
                                    </Grid>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="CONNECTING TO CAMERA"
                                                   Foreground="{StaticResource PrimaryBrush}"
                                                   FontSize="18"
                                                   FontWeight="Bold"/>
                                        <TextBlock x:Name="ConnectionTargetText"
                                                   Text="192.168.50.224"
                                                   Foreground="#888888"
                                                   FontSize="13"
                                                   Margin="0,3,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Connection Steps -->
                                <StackPanel x:Name="ConnectionStepsPanel" Margin="10,0,0,0">
                                    <!-- Step 1: Authentication -->
                                    <Grid x:Name="Step1Grid" Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="Step1Icon" Text="○" FontSize="16"
                                                   Foreground="#555555" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="Step1Text" Grid.Column="1"
                                                   Text="Authenticating..."
                                                   Foreground="#888888" FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </Grid>

                                    <!-- Step 2: ONVIF -->
                                    <Grid x:Name="Step2Grid" Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="Step2Icon" Text="○" FontSize="16"
                                                   Foreground="#555555" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="Step2Text" Grid.Column="1"
                                                   Text="Initializing PTZ control..."
                                                   Foreground="#555555" FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </Grid>

                                    <!-- Step 3: Streams -->
                                    <Grid x:Name="Step3Grid" Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="Step3Icon" Text="○" FontSize="16"
                                                   Foreground="#555555" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="Step3Text" Grid.Column="1"
                                                   Text="Detecting video streams..."
                                                   Foreground="#555555" FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </Grid>

                                    <!-- Step 4: Video -->
                                    <Grid x:Name="Step4Grid" Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="Step4Icon" Text="○" FontSize="16"
                                                   Foreground="#555555" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="Step4Text" Grid.Column="1"
                                                   Text="Starting video stream..."
                                                   Foreground="#555555" FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </Grid>

                                    <!-- Step 5: Info -->
                                    <Grid x:Name="Step5Grid" Margin="0,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="Step5Icon" Text="○" FontSize="16"
                                                   Foreground="#555555" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="Step5Text" Grid.Column="1"
                                                   Text="Loading device info..."
                                                   Foreground="#555555" FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Progress bar -->
                                <Grid Margin="0,25,0,0">
                                    <Border Background="#333333" CornerRadius="3" Height="6"/>
                                    <Border x:Name="ConnectionProgressBar"
                                            Background="{StaticResource PrimaryBrush}"
                                            CornerRadius="3" Height="6"
                                            HorizontalAlignment="Left" Width="0"/>
                                </Grid>

                                <!-- Current action text -->
                                <TextBlock x:Name="ConnectionActionText"
                                           Text="Please wait..."
                                           Foreground="#AAAAAA"
                                           FontSize="12"
                                           FontStyle="Italic"
                                           HorizontalAlignment="Center"
                                           Margin="0,15,0,0"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Border>

            <!-- Status Bar -->
            <Grid Grid.Row="1" Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock x:Name="ConnectionStatus"
                           Grid.Column="0"
                           Text="Disconnected"
                           Foreground="{StaticResource AccentRedBrush}"
                           FontWeight="Bold"
                           FontSize="14"
                           VerticalAlignment="Center"/>

                <TextBlock x:Name="FrameResolutionStatus"
                           Grid.Column="1"
                           Text="Resolution: --"
                           Foreground="{StaticResource PrimaryBrush}"
                           FontSize="14"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,20,0">
                    <TextBlock x:Name="StreamQualityStatus"
                               Text="Stream: --"
                               Foreground="{StaticResource PrimaryBrush}"
                               FontSize="14"
                               VerticalAlignment="Center"/>
                    <Button x:Name="QuickQualityToggle"
                            Content="Toggle"
                            Click="QuickQualityToggle_Click"
                            FontSize="10"
                            Padding="6,2"
                            Margin="10,0,0,0"
                            ToolTip="Toggle between 4K and SD quality"
                            IsEnabled="False"/>
                </StackPanel>

                <TextBlock x:Name="RecordingStatus"
                           Grid.Column="3"
                           Text="Not Recording"
                           Foreground="#888888"
                           FontSize="14"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="200"/>
            </Grid>
        </Grid>

        <!-- Right Panel - Tabbed Controls -->
        <TabControl Grid.Column="1" Margin="5" Background="{StaticResource PanelBrush}"
                    BorderBrush="{StaticResource PrimaryBrush}">

            <!-- Controls Tab -->
            <TabItem Header="Controls">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">

                        <!-- Keyboard Shortcuts Info -->
                        <Expander Header="Keyboard Shortcuts" Margin="0,0,0,10" IsExpanded="False"
                                  Foreground="#888888">
                            <Border Background="#252525" CornerRadius="3" Padding="10" Margin="0,5,0,0">
                                <TextBlock Foreground="#AAAAAA" FontSize="11" TextWrapping="Wrap">
                                    <Run FontWeight="Bold" Foreground="White">PTZ Control:</Run><LineBreak/>
                                    Arrow Keys - Pan/Tilt<LineBreak/>
                                    +/- Keys - Zoom In/Out<LineBreak/>
                                    Space - Stop Movement<LineBreak/>
                                    <LineBreak/>
                                    <Run FontWeight="Bold" Foreground="White">Focus Control:</Run><LineBreak/>
                                    W - Focus Near<LineBreak/>
                                    S - Focus Far<LineBreak/>
                                    F - Auto Focus<LineBreak/>
                                    <LineBreak/>
                                    <Run FontWeight="Bold" Foreground="White">Presets:</Run><LineBreak/>
                                    1-9 - Go to Preset
                                </TextBlock>
                            </Border>
                        </Expander>

                        <!-- PTZ Controls -->
                        <GroupBox Header="PTZ Controls" x:Name="PTZControls" IsEnabled="False">
                            <StackPanel>
                                <!-- Speed Slider -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Speed:" VerticalAlignment="Center"/>
                                    <Slider x:Name="SpeedSlider" Grid.Column="1"
                                            Minimum="0.1" Maximum="1.0" Value="1.0"
                                            VerticalAlignment="Center" Margin="10,0"
                                            ValueChanged="SpeedSlider_ValueChanged"/>
                                    <Label x:Name="SpeedLabel" Grid.Column="2" Content="1.0"
                                           Foreground="{StaticResource PrimaryBrush}" FontWeight="Bold"/>
                                </Grid>

                                <!-- Directional Pad -->
                                <Grid HorizontalAlignment="Center" Margin="0,10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="60"/>
                                        <RowDefinition Height="60"/>
                                        <RowDefinition Height="60"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>

                                    <Button Grid.Row="0" Grid.Column="1" Content="Up"
                                            PreviewMouseDown="UpButton_MouseDown"
                                            PreviewMouseUp="PTZButton_MouseUp"
                                            Margin="2"/>
                                    <Button Grid.Row="1" Grid.Column="0" Content="Left"
                                            PreviewMouseDown="LeftButton_MouseDown"
                                            PreviewMouseUp="PTZButton_MouseUp"
                                            Margin="2"/>
                                    <Button Grid.Row="1" Grid.Column="1" Content="Stop"
                                            Click="StopButton_Click"
                                            Background="{StaticResource AccentRedBrush}"
                                            Margin="2"/>
                                    <Button Grid.Row="1" Grid.Column="2" Content="Right"
                                            PreviewMouseDown="RightButton_MouseDown"
                                            PreviewMouseUp="PTZButton_MouseUp"
                                            Margin="2"/>
                                    <Button Grid.Row="2" Grid.Column="1" Content="Down"
                                            PreviewMouseDown="DownButton_MouseDown"
                                            PreviewMouseUp="PTZButton_MouseUp"
                                            Margin="2"/>
                                </Grid>

                                <!-- Zoom Controls -->
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Content="Zoom +"
                                            PreviewMouseDown="ZoomInButton_MouseDown"
                                            PreviewMouseUp="PTZButton_MouseUp"
                                            Margin="2"/>
                                    <Button Grid.Column="1" Content="Zoom -"
                                            PreviewMouseDown="ZoomOutButton_MouseDown"
                                            PreviewMouseUp="PTZButton_MouseUp"
                                            Margin="2"/>
                                </Grid>

                                <!-- Focus Controls -->
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Content="Focus Near"
                                            PreviewMouseDown="FocusNearButton_MouseDown"
                                            PreviewMouseUp="FocusButton_MouseUp"
                                            Margin="2"/>
                                    <Button Grid.Column="1" Content="Focus Far"
                                            PreviewMouseDown="FocusFarButton_MouseDown"
                                            PreviewMouseUp="FocusButton_MouseUp"
                                            Margin="2"/>
                                </Grid>
                                <Button Content="Auto Focus"
                                        Click="AutoFocusButton_Click"
                                        Margin="2,5,2,0"
                                        Background="{StaticResource AccentGreenBrush}"
                                        Foreground="White"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Click-to-Center Calibration -->
                        <GroupBox Header="Click-to-Center Calibration">
                            <StackPanel>
                                <!-- Calibration Status -->
                                <TextBlock x:Name="CalibrationStatusText"
                                           Text="Not calibrated"
                                           Foreground="#888888" FontSize="11"
                                           Margin="0,0,0,8"/>

                                <!-- Pan/Tilt Display -->
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Pan: " Foreground="#888888" FontSize="10"/>
                                        <TextBlock x:Name="PanMultiplierText" Text="1700" Foreground="{StaticResource PrimaryBrush}" FontSize="10" FontWeight="Bold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <TextBlock Text="Tilt: " Foreground="#888888" FontSize="10"/>
                                        <TextBlock x:Name="TiltMultiplierText" Text="1700" Foreground="{StaticResource PrimaryBrush}" FontSize="10" FontWeight="Bold"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Legacy Scale Slider -->
                                <Expander Header="Manual Adjustment" IsExpanded="False" Margin="0,0,0,5"
                                          Foreground="#888888">
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="40"/>
                                        </Grid.ColumnDefinitions>
                                        <Label Content="Scale:" VerticalAlignment="Center" FontSize="10"/>
                                        <Slider x:Name="TravelSlider" Grid.Column="1"
                                                Minimum="1000" Maximum="2500" Value="1700"
                                                TickFrequency="50" IsSnapToTickEnabled="True"
                                                VerticalAlignment="Center" Margin="5,0"
                                                ValueChanged="TravelSlider_ValueChanged"/>
                                        <TextBlock x:Name="TravelValueLabel" Grid.Column="2"
                                                   Text="1700" VerticalAlignment="Center"
                                                   Foreground="{StaticResource PrimaryBrush}"
                                                   FontWeight="Bold" FontSize="12"/>
                                    </Grid>
                                </Expander>

                                <!-- Calibration Buttons -->
                                <Grid Margin="0,5,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Quick (4 pts)"
                                            Click="QuickCalibration_Click"
                                            Background="{StaticResource AccentGreenBrush}"
                                            Foreground="White"
                                            Padding="5,8"
                                            Margin="0,0,2,0"
                                            ToolTip="Fast calibration with 4 targets (cardinal directions)"/>
                                    <Button Grid.Column="1" Content="Full (16 pts)"
                                            Click="FullCalibration_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Foreground="White"
                                            Padding="5,8"
                                            Margin="2,0,0,0"
                                            ToolTip="Complete calibration with 16 targets (all directions, all distances)"/>
                                </Grid>
                                <TextBlock Text="Click on video to center camera on that point."
                                           Foreground="#666666" FontSize="9" Margin="0,8,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Presets -->
                        <GroupBox Header="Presets" x:Name="PresetsGroup" IsEnabled="False">
                            <StackPanel>
                                <!-- Quick Preset Buttons -->
                                <Label Content="Quick Presets:" Margin="0,0,0,2"/>
                                <UniformGrid Rows="1" Columns="4" Margin="0,0,0,10">
                                    <Button Content="1" Click="QuickPreset_Click" Tag="1"
                                            ToolTip="Go to Preset 1"/>
                                    <Button Content="2" Click="QuickPreset_Click" Tag="2"
                                            ToolTip="Go to Preset 2" Margin="2,0,0,0"/>
                                    <Button Content="3" Click="QuickPreset_Click" Tag="3"
                                            ToolTip="Go to Preset 3" Margin="2,0,0,0"/>
                                    <Button Content="4" Click="QuickPreset_Click" Tag="4"
                                            ToolTip="Go to Preset 4" Margin="2,0,0,0"/>
                                </UniformGrid>

                                <!-- Direct Preset Number Input -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Go to #:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="PresetNumberInput" Grid.Column="1"
                                             Text="1" MaxLength="3"
                                             VerticalContentAlignment="Center"
                                             KeyDown="PresetNumberInput_KeyDown"
                                             ToolTip="Enter preset number (1-255) and press Enter"/>
                                    <Button Grid.Column="2" Content="Go" Margin="5,0,0,0"
                                            Click="GotoPresetNumber_Click"/>
                                </Grid>

                                <!-- Preset Dropdown (for presets 5-8) -->
                                <Expander Header="More Presets (5-8)" IsExpanded="False" Margin="0,0,0,5">
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox x:Name="PresetCombo" SelectedIndex="0" Margin="0,0,5,0">
                                            <ComboBoxItem Content="5"/>
                                            <ComboBoxItem Content="6"/>
                                            <ComboBoxItem Content="7"/>
                                            <ComboBoxItem Content="8"/>
                                        </ComboBox>
                                        <Button Grid.Column="1" Content="Go"
                                                Click="GotoPresetButton_Click"/>
                                    </Grid>
                                </Expander>

                                <!-- Save Current Position as Preset -->
                                <Expander Header="Save Position" IsExpanded="False" Margin="0,5,0,0">
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="60"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="SavePresetNumber"
                                                 Text="1" MaxLength="3"
                                                 VerticalContentAlignment="Center"
                                                 ToolTip="Preset number to save (1-255)"/>
                                        <TextBox x:Name="SavePresetName" Grid.Column="1"
                                                 Text="Position" Margin="5,0,0,0"
                                                 VerticalContentAlignment="Center"
                                                 ToolTip="Optional name for the preset"/>
                                        <Button Grid.Column="2" Content="Save"
                                                Click="SavePreset_Click"
                                                Margin="5,0,0,0" Width="50"
                                                ToolTip="Save current camera position as preset"/>
                                    </Grid>
                                </Expander>
                            </StackPanel>
                        </GroupBox>

                        <!-- Recording -->
                        <GroupBox Header="Recording" x:Name="RecordingGroup" IsEnabled="False">
                            <StackPanel>
                                <Label Content="Save Location:" Margin="0,0,0,2"/>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="RecordingFolderText"
                                             IsReadOnly="True"
                                             Text="(Click Browse)"
                                             VerticalContentAlignment="Center"
                                             Height="28"
                                             ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                                    <Button Grid.Column="1" Content="Browse"
                                            Click="BrowseRecordingFolder_Click"
                                            Width="60" Margin="5,0,0,0"/>
                                    <Button Grid.Column="2" Content="Open"
                                            Click="OpenRecordingFolder_Click"
                                            Width="45" Margin="5,0,0,0"
                                            ToolTip="Open recording folder in Explorer"/>
                                </Grid>

                                <!-- Quality Selection -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Quality:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="RecordingQualityCombo" Grid.Column="1"
                                              SelectionChanged="RecordingQualityCombo_SelectionChanged"
                                              SelectedIndex="2" MinWidth="120">
                                        <ComboBoxItem Content="Standard" Tag="Standard" ToolTip="192kbps AAC audio"/>
                                        <ComboBoxItem Content="High" Tag="High" ToolTip="256kbps AAC audio"/>
                                        <ComboBoxItem Content="Maximum" Tag="Maximum" ToolTip="320kbps HQ AAC audio"/>
                                    </ComboBox>
                                </Grid>

                                <Button x:Name="RecordButton"
                                        Content="Start Recording"
                                        Click="RecordButton_Click"
                                        Height="40"
                                        Margin="0,0,0,5"/>
                                <StackPanel x:Name="StoppingIndicator" Orientation="Horizontal"
                                            Visibility="Collapsed" Margin="0,0,0,5">
                                    <TextBlock Text="Stopping" Foreground="Orange" FontSize="11"
                                               VerticalAlignment="Center"/>
                                    <TextBlock x:Name="StoppingDots" Text="..." Foreground="Orange"
                                               FontSize="11" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock x:Name="RecordingSavedText"
                                           Text=""
                                           Foreground="LimeGreen" FontSize="10"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,5"/>
                                <TextBlock x:Name="RecordingSegmentInfo"
                                           Text="30min segments, 10s overlap"
                                           Foreground="Gray" FontSize="11"
                                           Margin="0,0,0,5"/>
                                <Button x:Name="SnapshotButton"
                                        Content="Take Snapshot"
                                        Click="SnapshotButton_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Audio -->
                        <GroupBox Header="Audio" x:Name="AudioGroup" IsEnabled="False">
                            <StackPanel>
                                <Button x:Name="AudioButton"
                                        Content="Enable Audio"
                                        Click="AudioButton_Click"
                                        Height="40"
                                        Margin="0,0,0,10"/>
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Volume:" VerticalAlignment="Center"/>
                                    <Slider x:Name="VolumeSlider" Grid.Column="1"
                                            Minimum="0" Maximum="100" Value="80"
                                            VerticalAlignment="Center" Margin="10,0"
                                            ValueChanged="VolumeSlider_ValueChanged"/>
                                    <Label x:Name="VolumeLabel" Grid.Column="2" Content="80%"
                                           Foreground="{StaticResource PrimaryBrush}" FontWeight="Bold" Width="45"/>
                                </Grid>
                                <Button x:Name="MuteButton"
                                        Content="Mute"
                                        Click="MuteButton_Click"/>
                                <TextBlock x:Name="AudioStatusText"
                                           Text="Audio: Disabled"
                                           Foreground="#888888"
                                           FontSize="11"
                                           Margin="5,10,5,0"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Settings Tab -->
            <TabItem Header="Settings">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">

                        <!-- Connection Controls -->
                        <GroupBox Header="Connection">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" Grid.Column="0" Content="IP:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CameraIpText" Grid.Row="0" Grid.Column="1"
                                             Text="192.168.50.224" Margin="5"/>

                                    <Label Grid.Row="1" Grid.Column="0" Content="User:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="UsernameText" Grid.Row="1" Grid.Column="1"
                                             Text="admin" Margin="5"/>

                                    <Label Grid.Row="2" Grid.Column="0" Content="Pass:" VerticalAlignment="Center"/>
                                    <PasswordBox x:Name="PasswordText" Grid.Row="2" Grid.Column="1"
                                                 Margin="5" Background="#1E1E1E" Foreground="White"
                                                 BorderBrush="{StaticResource PrimaryBrush}"
                                                 KeyDown="PasswordText_KeyDown"/>
                                </Grid>

                                <Button x:Name="ConnectButton"
                                        Content="Connect Camera"
                                        Click="ConnectButton_Click"
                                        Height="40"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Stream Settings -->
                        <GroupBox Header="Stream Quality" x:Name="StreamSettingsGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Quality:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="StreamQualityCombo" Grid.Column="1" Margin="5"
                                              SelectionChanged="StreamQualityCombo_SelectionChanged" MinWidth="140">
                                        <ComboBoxItem Content="Main (4K)" Tag="Main" ToolTip="3840x2160 - High quality"/>
                                        <ComboBoxItem Content="Sub (SD)" Tag="Sub" ToolTip="720x480 - Lower bandwidth"/>
                                    </ComboBox>
                                </Grid>
                                <TextBlock x:Name="StreamUrlText"
                                           Text="RTSP URL: --"
                                           Foreground="#888888"
                                           FontSize="11"
                                           TextWrapping="Wrap"
                                           Margin="5"/>
                                <Button Content="Apply Stream Quality"
                                        Click="ApplyStreamQuality_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Image Settings (via RPC) -->
                        <GroupBox Header="Image Settings" x:Name="ImageSettingsGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="70"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="35"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" Content="Brightness:" FontSize="11"/>
                                    <Slider x:Name="BrightnessSlider" Grid.Row="0" Grid.Column="1"
                                            Minimum="0" Maximum="100" Value="50"
                                            ValueChanged="ImageSlider_ValueChanged" Tag="Brightness"/>
                                    <TextBlock x:Name="BrightnessValue" Grid.Row="0" Grid.Column="2"
                                               Text="50" VerticalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>

                                    <Label Grid.Row="1" Content="Contrast:" FontSize="11"/>
                                    <Slider x:Name="ContrastSlider" Grid.Row="1" Grid.Column="1"
                                            Minimum="0" Maximum="100" Value="50"
                                            ValueChanged="ImageSlider_ValueChanged" Tag="Contrast"/>
                                    <TextBlock x:Name="ContrastValue" Grid.Row="1" Grid.Column="2"
                                               Text="50" VerticalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>

                                    <Label Grid.Row="2" Content="Saturation:" FontSize="11"/>
                                    <Slider x:Name="SaturationSlider" Grid.Row="2" Grid.Column="1"
                                            Minimum="0" Maximum="100" Value="50"
                                            ValueChanged="ImageSlider_ValueChanged" Tag="Saturation"/>
                                    <TextBlock x:Name="SaturationValue" Grid.Row="2" Grid.Column="2"
                                               Text="50" VerticalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>

                                    <Label Grid.Row="3" Content="Sharpness:" FontSize="11"/>
                                    <Slider x:Name="SharpnessSlider" Grid.Row="3" Grid.Column="1"
                                            Minimum="0" Maximum="100" Value="50"
                                            ValueChanged="ImageSlider_ValueChanged" Tag="Sharpness"/>
                                    <TextBlock x:Name="SharpnessValue" Grid.Row="3" Grid.Column="2"
                                               Text="50" VerticalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>

                                    <Label Grid.Row="4" Content="Hue:" FontSize="11"/>
                                    <Slider x:Name="HueSlider" Grid.Row="4" Grid.Column="1"
                                            Minimum="0" Maximum="100" Value="50"
                                            ValueChanged="ImageSlider_ValueChanged" Tag="Hue"/>
                                    <TextBlock x:Name="HueValue" Grid.Row="4" Grid.Column="2"
                                               Text="50" VerticalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>
                                </Grid>

                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Load" Click="LoadImageSettings_Click" Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Apply" Click="ApplyImageSettings_Click"
                                            Background="{StaticResource AccentOrangeBrush}" Margin="2,0,0,0"/>
                                </Grid>
                                <Button Content="Reset to Default" Click="ResetImageSettings_Click"
                                        Margin="0,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Video Encoder Settings -->
                        <GroupBox Header="Video Encoder" x:Name="EncoderSettingsGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" Grid.Column="0" Content="Res:" VerticalAlignment="Center" ToolTip="Resolution"/>
                                    <ComboBox x:Name="ResolutionCombo" Grid.Row="0" Grid.Column="1" Margin="5" MinWidth="110">
                                        <ComboBoxItem Content="4K" Tag="3840x2160" ToolTip="3840x2160"/>
                                        <ComboBoxItem Content="QHD" Tag="2560x1440" ToolTip="2560x1440"/>
                                        <ComboBoxItem Content="1080p" Tag="1920x1080" ToolTip="1920x1080"/>
                                        <ComboBoxItem Content="720p" Tag="1280x720" ToolTip="1280x720"/>
                                    </ComboBox>

                                    <Label Grid.Row="1" Grid.Column="0" Content="FPS:" VerticalAlignment="Center" ToolTip="Frames per second"/>
                                    <ComboBox x:Name="FrameRateCombo" Grid.Row="1" Grid.Column="1" Margin="5" MinWidth="110">
                                        <ComboBoxItem Content="60" Tag="60"/>
                                        <ComboBoxItem Content="30" Tag="30"/>
                                        <ComboBoxItem Content="25" Tag="25"/>
                                        <ComboBoxItem Content="20" Tag="20"/>
                                        <ComboBoxItem Content="15" Tag="15"/>
                                    </ComboBox>

                                    <Label Grid.Row="2" Grid.Column="0" Content="Bitrate:" VerticalAlignment="Center" ToolTip="Video bitrate (kbps)"/>
                                    <ComboBox x:Name="BitrateCombo" Grid.Row="2" Grid.Column="1" Margin="5" MinWidth="110">
                                        <ComboBoxItem Content="Auto" Tag="0" ToolTip="Let camera decide"/>
                                        <ComboBoxItem Content="8 Mbps" Tag="8000"/>
                                        <ComboBoxItem Content="6 Mbps" Tag="6000"/>
                                        <ComboBoxItem Content="4 Mbps" Tag="4000"/>
                                        <ComboBoxItem Content="2 Mbps" Tag="2000"/>
                                    </ComboBox>

                                    <Label Grid.Row="3" Grid.Column="0" Content="Profile:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="ProfileCombo" Grid.Row="3" Grid.Column="1" Margin="5">
                                        <ComboBoxItem Content="High" Tag="High"/>
                                        <ComboBoxItem Content="Main" Tag="Main"/>
                                        <ComboBoxItem Content="Baseline" Tag="Baseline"/>
                                    </ComboBox>
                                </Grid>

                                <Button Content="Load Current Settings"
                                        Click="LoadEncoderSettings_Click"
                                        Margin="0,10,0,5"/>
                                <Button Content="Apply Encoder Settings"
                                        Click="ApplyEncoderSettings_Click"
                                        Margin="0,0,0,5"
                                        Background="{StaticResource AccentOrangeBrush}"/>
                                <Button Content="⚡ Optimize for Max Quality"
                                        Click="OptimizeMaxQuality_Click"
                                        Background="{StaticResource AccentGreenBrush}"
                                        Foreground="White"
                                        ToolTip="Set camera to 4K, 8Mbps, 25fps, High Profile"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- OSD Settings -->
                        <GroupBox Header="OSD (On-Screen Display)" x:Name="OSDSettingsGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Camera Title:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="OsdTitleText" Grid.Column="1" Margin="5"
                                             Text="Camera"/>
                                </Grid>

                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Position:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="OsdPositionCombo" Grid.Column="1" Margin="5">
                                        <ComboBoxItem Content="Upper Left" Tag="UpperLeft"/>
                                        <ComboBoxItem Content="Upper Right" Tag="UpperRight"/>
                                        <ComboBoxItem Content="Lower Left" Tag="LowerLeft"/>
                                        <ComboBoxItem Content="Lower Right" Tag="LowerRight"/>
                                    </ComboBox>
                                </Grid>

                                <Button Content="Load Current OSD"
                                        Click="LoadOsdSettings_Click"
                                        Margin="0,0,0,5"/>
                                <Button Content="Apply OSD Settings"
                                        Click="ApplyOsdSettings_Click"
                                        Background="{StaticResource AccentOrangeBrush}"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Device Info -->
                        <GroupBox Header="Device Information" x:Name="DeviceInfoGroup" IsEnabled="False">
                            <StackPanel>
                                <TextBlock x:Name="DeviceInfoText"
                                           Text="Connect to view device info..."
                                           Foreground="#AAAAAA"
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                                <Button Content="Refresh Device Info"
                                        Click="RefreshDeviceInfo_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- FFmpeg Settings -->
                        <GroupBox Header="FFmpeg (Recording)">
                            <StackPanel>
                                <TextBlock x:Name="FFmpegStatusText"
                                           Text="FFmpeg: Checking..."
                                           Foreground="#AAAAAA"
                                           FontSize="11"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,10"/>
                                <Label Content="Custom Path (optional):" Margin="0,0,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="FFmpegPathText"
                                             Text=""
                                             VerticalContentAlignment="Center"
                                             Height="28"
                                             ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                                    <Button Grid.Column="1" Content="Browse"
                                            Click="BrowseFFmpegPath_Click"
                                            Width="60" Margin="5,0,0,0"/>
                                </Grid>
                                <Button Content="Detect FFmpeg"
                                        Click="DetectFFmpeg_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- About -->
                        <GroupBox Header="About">
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Foreground="White" FontSize="14">
                                    Jennov PTZ Camera Control
                                </TextBlock>
                                <TextBlock Foreground="#888888" FontSize="12" Margin="0,5,0,0">
                                    Version 1.0.0
                                </TextBlock>
                                <TextBlock Foreground="#AAAAAA" FontSize="11" TextWrapping="Wrap" Margin="0,10,0,0">
                                    Control Jennov PTZ cameras via ONVIF protocol.
                                    Features: PTZ control, 4K streaming, recording,
                                    presets, focus control, and more.
                                </TextBlock>
                                <TextBlock Foreground="#666666" FontSize="10" Margin="0,10,0,0">
                                    Built with .NET 8, WPF, OpenCvSharp, LibVLCSharp
                                </TextBlock>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Camera Info Tab -->
            <TabItem Header="Info">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">

                        <!-- Camera Time -->
                        <GroupBox Header="Camera Time" x:Name="CameraTimeGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Camera:" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="CameraTimeText" Grid.Column="1"
                                               Text="--"
                                               Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"
                                               FontWeight="Bold"/>
                                </Grid>
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Refresh" Click="RefreshCameraTime_Click" Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Sync to PC"
                                            Click="SyncCameraTime_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Margin="2,0,0,0"
                                            ToolTip="Set camera time to current PC time"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Storage Info -->
                        <GroupBox Header="Storage" x:Name="StorageInfoGroup" IsEnabled="False">
                            <StackPanel>
                                <TextBlock x:Name="StorageInfoText"
                                           Text="Connect to view storage info..."
                                           Foreground="#AAAAAA"
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                                <ProgressBar x:Name="StorageProgress"
                                             Height="20"
                                             Margin="0,10,0,5"
                                             Foreground="{StaticResource PrimaryBrush}"
                                             Background="#333333"/>
                                <TextBlock x:Name="StorageUsageText"
                                           Text="0% used"
                                           Foreground="#888888"
                                           FontSize="11"
                                           HorizontalAlignment="Center"/>
                                <Button Content="Refresh Storage Info"
                                        Click="RefreshStorageInfo_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Users -->
                        <GroupBox Header="Users" x:Name="UsersGroup" IsEnabled="False">
                            <StackPanel>
                                <ListBox x:Name="UsersListBox"
                                         Height="100"
                                         Background="#252525"
                                         Foreground="White"
                                         BorderBrush="{StaticResource PrimaryBrush}"/>
                                <Button Content="Refresh Users"
                                        Click="RefreshUsers_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Event Capabilities -->
                        <GroupBox Header="Event Capabilities" x:Name="EventsGroup" IsEnabled="False">
                            <StackPanel>
                                <TextBlock x:Name="EventCapsText"
                                           Text="Connect to view event capabilities..."
                                           Foreground="#AAAAAA"
                                           FontSize="11"
                                           TextWrapping="Wrap"/>
                                <Button Content="Refresh Events"
                                        Click="RefreshEventCaps_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Services -->
                        <GroupBox Header="RPC Services" x:Name="ServicesGroup" IsEnabled="False">
                            <StackPanel>
                                <ListBox x:Name="ServicesListBox"
                                         Height="120"
                                         Background="#252525"
                                         Foreground="White"
                                         BorderBrush="{StaticResource PrimaryBrush}"/>
                                <Button Content="Refresh Services"
                                        Click="RefreshServices_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Advanced Tab -->
            <TabItem Header="Advanced">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">

                        <!-- PTZ Tours -->
                        <GroupBox Header="PTZ Tours" x:Name="ToursGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="TourCombo" DisplayMemberPath="Name"/>
                                    <Button Grid.Column="1" Content="Refresh"
                                            Click="RefreshTours_Click"
                                            Width="60" Margin="5,0,0,0"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Start Tour"
                                            Click="StartTour_Click"
                                            Background="{StaticResource AccentGreenBrush}"
                                            Foreground="White"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Stop Tour"
                                            Click="StopTour_Click"
                                            Background="{StaticResource AccentRedBrush}"
                                            Foreground="White"
                                            Margin="2,0,0,0"/>
                                </Grid>
                                <TextBlock x:Name="TourStatusText"
                                           Text="No tour active"
                                           Foreground="#888888"
                                           FontSize="11"
                                           Margin="0,10,0,0"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- PTZ Patterns -->
                        <GroupBox Header="PTZ Patterns" x:Name="PatternsGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Pattern #:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="PatternCombo" Grid.Column="1" Margin="5,0,0,0">
                                        <ComboBoxItem Content="Pattern 1" Tag="1"/>
                                        <ComboBoxItem Content="Pattern 2" Tag="2"/>
                                        <ComboBoxItem Content="Pattern 3" Tag="3"/>
                                        <ComboBoxItem Content="Pattern 4" Tag="4"/>
                                        <ComboBoxItem Content="Pattern 5" Tag="5"/>
                                    </ComboBox>
                                </Grid>
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Start Recording"
                                            Click="StartPatternRecord_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Foreground="White"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Stop Recording"
                                            Click="StopPatternRecord_Click"
                                            Margin="2,0,0,0"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Play Pattern"
                                            Click="StartPatternReplay_Click"
                                            Background="{StaticResource AccentGreenBrush}"
                                            Foreground="White"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Stop Pattern"
                                            Click="StopPatternReplay_Click"
                                            Background="{StaticResource AccentRedBrush}"
                                            Foreground="White"
                                            Margin="2,0,0,0"/>
                                </Grid>
                                <TextBlock x:Name="PatternStatusText"
                                           Text="Use patterns to record and replay PTZ movements"
                                           Foreground="#888888"
                                           FontSize="10"
                                           TextWrapping="Wrap"
                                           Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- PTZ Auto Scan -->
                        <GroupBox Header="Auto Scan" x:Name="ScanGroup" IsEnabled="False">
                            <StackPanel>
                                <TextBlock Text="Set scan limits, then start auto-scan."
                                           Foreground="#888888" FontSize="11"
                                           Margin="0,0,0,10"/>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Set Left Limit"
                                            Click="SetScanLeftLimit_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Set Right Limit"
                                            Click="SetScanRightLimit_Click"
                                            Margin="2,0,0,0"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Start Scan"
                                            Click="StartScan_Click"
                                            Background="{StaticResource AccentGreenBrush}"
                                            Foreground="White"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Stop Scan"
                                            Click="StopScan_Click"
                                            Background="{StaticResource AccentRedBrush}"
                                            Foreground="White"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Wiper Control -->
                        <GroupBox Header="Wiper / Rain Brush" x:Name="WiperGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Wipe Once"
                                            Click="WiperOnce_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Start"
                                            Click="WiperStart_Click"
                                            Background="{StaticResource AccentGreenBrush}"
                                            Foreground="White"
                                            Margin="2,0,2,0"/>
                                    <Button Grid.Column="2" Content="Stop"
                                            Click="WiperStop_Click"
                                            Background="{StaticResource AccentRedBrush}"
                                            Foreground="White"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Two-Way Audio -->
                        <GroupBox Header="Two-Way Audio" x:Name="TwoWayAudioGroup" IsEnabled="False">
                            <StackPanel>
                                <TextBlock Text="Talk to camera (requires microphone)"
                                           Foreground="#888888" FontSize="11"
                                           Margin="0,0,0,10"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button x:Name="TalkButton" Content="Start Talk"
                                            Click="StartTalk_Click"
                                            Background="{StaticResource AccentGreenBrush}"
                                            Foreground="White"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Stop Talk"
                                            Click="StopTalk_Click"
                                            Background="{StaticResource AccentRedBrush}"
                                            Foreground="White"
                                            Margin="2,0,0,0"/>
                                </Grid>
                                <TextBlock x:Name="TalkStatusText"
                                           Text="Two-way audio inactive"
                                           Foreground="#888888"
                                           FontSize="11"
                                           Margin="0,10,0,0"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Privacy Masks -->
                        <GroupBox Header="Privacy Masks" x:Name="PrivacyMasksGroup" IsEnabled="False">
                            <StackPanel>
                                <TextBlock Text="Configure up to 4 privacy mask regions."
                                           Foreground="#888888" FontSize="11"
                                           Margin="0,0,0,10"/>
                                <ListBox x:Name="PrivacyMasksListBox"
                                         Height="80"
                                         Background="#252525"
                                         Foreground="White"
                                         BorderBrush="{StaticResource PrimaryBrush}"/>
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Load Masks"
                                            Click="LoadPrivacyMasks_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Toggle Mask"
                                            Click="TogglePrivacyMask_Click"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Alarms -->
                        <GroupBox Header="Alarm I/O" x:Name="AlarmsGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Inputs:" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="AlarmInputsText" Grid.Column="1"
                                               Text="--"
                                               Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Outputs:" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="AlarmOutputsText" Grid.Column="1"
                                               Text="--"
                                               Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Refresh"
                                            Click="RefreshAlarms_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Trigger Out"
                                            Click="TriggerAlarmOutput_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Foreground="White"
                                            Margin="2,0,2,0"/>
                                    <Button Grid.Column="2" Content="Clear Out"
                                            Click="ClearAlarmOutput_Click"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Network Tab -->
            <TabItem Header="Network">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">

                        <!-- Network Info -->
                        <GroupBox Header="Network Configuration" x:Name="NetworkGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Row="0" Content="Hostname:" FontSize="11"/>
                                    <TextBlock x:Name="HostnameText" Grid.Row="0" Grid.Column="1"
                                               Text="--" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                    <Label Grid.Row="1" Content="Interface:" FontSize="11"/>
                                    <TextBlock x:Name="InterfaceText" Grid.Row="1" Grid.Column="1"
                                               Text="--" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                    <Label Grid.Row="2" Content="MAC:" FontSize="11"/>
                                    <TextBlock x:Name="MacAddressText" Grid.Row="2" Grid.Column="1"
                                               Text="--" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                                <Button Content="Refresh Network Info"
                                        Click="RefreshNetworkInfo_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- NTP Settings -->
                        <GroupBox Header="NTP Time Sync" x:Name="NtpGroup" IsEnabled="False">
                            <StackPanel>
                                <CheckBox x:Name="NtpEnabledCheck" Content="Enable NTP"
                                          Foreground="White" Margin="0,0,0,10"/>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Server:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="NtpServerText" Grid.Column="1"
                                             Text="pool.ntp.org" Margin="5,0,0,0"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Load NTP"
                                            Click="LoadNtpSettings_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Apply NTP"
                                            Click="ApplyNtpSettings_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Email Settings -->
                        <GroupBox Header="Email Notifications" x:Name="EmailGroup" IsEnabled="False">
                            <StackPanel>
                                <CheckBox x:Name="EmailEnabledCheck" Content="Enable Email Alerts"
                                          Foreground="White" Margin="0,0,0,10"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Row="0" Content="Server:" FontSize="11"/>
                                    <TextBox x:Name="EmailServerText" Grid.Row="0" Grid.Column="1" Margin="0,2"/>
                                    <Label Grid.Row="1" Content="Port:" FontSize="11"/>
                                    <TextBox x:Name="EmailPortText" Grid.Row="1" Grid.Column="1"
                                             Text="587" Margin="0,2"/>
                                    <Label Grid.Row="2" Content="User:" FontSize="11"/>
                                    <TextBox x:Name="EmailUserText" Grid.Row="2" Grid.Column="1" Margin="0,2"/>
                                    <Label Grid.Row="3" Content="To:" FontSize="11"/>
                                    <TextBox x:Name="EmailReceiverText" Grid.Row="3" Grid.Column="1" Margin="0,2"/>
                                </Grid>
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Load Email"
                                            Click="LoadEmailSettings_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Apply Email"
                                            Click="ApplyEmailSettings_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- WiFi Scanner -->
                        <GroupBox Header="WiFi Networks" x:Name="WifiGroup" IsEnabled="False">
                            <StackPanel>
                                <ListBox x:Name="WifiListBox"
                                         Height="100"
                                         Background="#252525"
                                         Foreground="White"
                                         BorderBrush="{StaticResource PrimaryBrush}"/>
                                <Button Content="Scan WiFi Networks"
                                        Click="ScanWifi_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Firmware Tab -->
            <TabItem Header="Firmware">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">

                        <!-- Firmware Info -->
                        <GroupBox Header="Firmware Information" x:Name="FirmwareGroup" IsEnabled="False">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Row="0" Content="Version:" FontSize="11"/>
                                    <TextBlock x:Name="FirmwareVersionText" Grid.Row="0" Grid.Column="1"
                                               Text="--" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center" FontWeight="Bold"/>
                                    <Label Grid.Row="1" Content="Build Date:" FontSize="11"/>
                                    <TextBlock x:Name="FirmwareBuildDateText" Grid.Row="1" Grid.Column="1"
                                               Text="--" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                    <Label Grid.Row="2" Content="Web Version:" FontSize="11"/>
                                    <TextBlock x:Name="FirmwareWebVersionText" Grid.Row="2" Grid.Column="1"
                                               Text="--" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                                <Button Content="Refresh Firmware Info"
                                        Click="RefreshFirmwareInfo_Click"
                                        Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Auto Maintenance -->
                        <GroupBox Header="Auto Maintenance" x:Name="MaintenanceGroup" IsEnabled="False">
                            <StackPanel>
                                <CheckBox x:Name="AutoRebootCheck" Content="Enable Auto Reboot"
                                          Foreground="White" Margin="0,0,0,10"/>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Row="0" Content="Day:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="RebootDayCombo" Grid.Row="0" Grid.Column="1" Margin="5,2">
                                        <ComboBoxItem Content="Sunday" Tag="0"/>
                                        <ComboBoxItem Content="Monday" Tag="1"/>
                                        <ComboBoxItem Content="Tuesday" Tag="2"/>
                                        <ComboBoxItem Content="Wednesday" Tag="3"/>
                                        <ComboBoxItem Content="Thursday" Tag="4"/>
                                        <ComboBoxItem Content="Friday" Tag="5"/>
                                        <ComboBoxItem Content="Saturday" Tag="6"/>
                                        <ComboBoxItem Content="Everyday" Tag="7"/>
                                    </ComboBox>
                                    <Label Grid.Row="1" Content="Time:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="RebootTimeText" Grid.Row="1" Grid.Column="1"
                                             Text="03:00" Margin="5,2"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Load"
                                            Click="LoadMaintenanceSettings_Click"
                                            Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="Apply"
                                            Click="ApplyMaintenanceSettings_Click"
                                            Background="{StaticResource AccentOrangeBrush}"
                                            Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Device Actions -->
                        <GroupBox Header="Device Actions" x:Name="DeviceActionsGroup" IsEnabled="False">
                            <StackPanel>
                                <Button Content="Reboot Camera"
                                        Click="RebootCamera_Click"
                                        Background="{StaticResource AccentOrangeBrush}"
                                        Foreground="White"
                                        Height="35"
                                        Margin="0,0,0,10"/>
                                <Button Content="Factory Reset (Soft)"
                                        Click="FactoryResetSoft_Click"
                                        Background="#FF6600"
                                        Foreground="White"
                                        Height="35"
                                        Margin="0,0,0,5"/>
                                <Button Content="Factory Reset (Hard)"
                                        Click="FactoryResetHard_Click"
                                        Background="{StaticResource AccentRedBrush}"
                                        Foreground="White"
                                        Height="35"/>
                                <TextBlock Text="Warning: Factory reset will erase all settings!"
                                           Foreground="{StaticResource AccentRedBrush}"
                                           FontSize="10"
                                           TextWrapping="Wrap"
                                           Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
